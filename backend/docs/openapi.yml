openapi: 3.0.3
info:
  title: API de Tienda Virtual - TP2
  description: >
    Documentación oficial de la API del proyecto final TP2.  
    Backend construido con Node.js + Express + Supabase.  
    Autenticación mediante JWT + Roles (admin/usuario).
  version: 1.0.0

servers:
  - url: https://estoy-cansado-jefe.onrender.com/api/v1
    description: Servidor de PRODUCCIÓN (Render)
  

tags:
  - name: Autenticación
  - name: Usuarios
  - name: Productos
  - name: Estadísticas

paths:

  /auth/register:
    post:
      tags: [Autenticación]
      summary: Registrar un nuevo usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nombre, apellido, email, password]
              properties:
                nombre: { type: string }
                apellido: { type: string }
                email: { type: string, format: email }
                password: { type: string }
      responses:
        "201": { description: Usuario registrado con éxito }
        "400": { description: Datos inválidos }

  /auth/login:
    post:
      tags: [Autenticación]
      summary: Iniciar sesión
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        "200": { description: Token generado }
        "401": { description: Credenciales incorrectas }

  /auth/me:
    get:
      tags: [Autenticación]
      summary: Obtener usuario autenticado
      security:
        - bearerAuth: []
      responses:
        "200": { description: Usuario autenticado }
        "401": { description: Token inválido o expirado }

  /users:
    get:
      tags: [Usuarios]
      summary: Obtener todos los usuarios (admin)
      security:
        - bearerAuth: []
      responses:
        "200": { description: Lista de usuarios }
        "403": { description: Requiere rol admin }

    post:
      tags: [Usuarios]
      summary: Crear usuario (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nombre, apellido, email, password, role]
              properties:
                nombre: { type: string }
                apellido: { type: string }
                email: { type: string }
                password: { type: string }
                role: { type: string, enum: [admin, user] }
      responses:
        "201": { description: Usuario creado }
        "403": { description: Solo administradores }

  /users/{id}:
    get:
      tags: [Usuarios]
      summary: Obtener usuario por ID (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Usuario encontrado }
        "404": { description: No existe }
        "403": { description: Solo admin }

    put:
      tags: [Usuarios]
      summary: Actualizar usuario (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nombre: { type: string }
                apellido: { type: string }
                email: { type: string }
                role: { type: string, enum: [admin, user] }
      responses:
        "200": { description: Usuario actualizado }
        "404": { description: No existe }

    delete:
      tags: [Usuarios]
      summary: Eliminar usuario (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Usuario eliminado }
        "404": { description: No existe }

  /products:
    get:
      tags: [Productos]
      summary: Obtener todos los productos
      responses:
        "200": { description: Lista de productos }

    post:
      tags: [Productos]
      summary: Crear producto (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nombre, precio]
              properties:
                nombre: { type: string }
                precio: { type: number }
      responses:
        "201": { description: Producto creado }
        "403": { description: Solo admin }

  /products/{id}:
    get:
      tags: [Productos]
      summary: Obtener producto por ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Producto encontrado }
        "404": { description: No existe }

    put:
      tags: [Productos]
      summary: Actualizar producto (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nombre: { type: string }
                precio: { type: number }
      responses:
        "200": { description: Producto actualizado }
        "403": { description: Solo admin }

    delete:
      tags: [Productos]
      summary: Eliminar producto (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Producto eliminado }
        "403": { description: Solo admin }

  /products/stats:
    get:
      tags: [Estadísticas]
      summary: Obtener estadísticas generales
      security:
        - bearerAuth: []
      responses:
        "200": { description: Estadísticas generadas }

  /products/analytics/prices:
    get:
      tags: [Estadísticas]
      summary: Distribución de precios de productos
      security:
        - bearerAuth: []
      responses:
        "200": { description: Análisis completado }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
